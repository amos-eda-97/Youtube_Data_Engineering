CREATE STORAGE INTEGRATION AWS_INTG_SNOWFLAKE
TYPE = EXTERNAL_STAGE
ENABLED = TRUE
STORAGE_PROVIDER = S3
STORAGE_ALLOWED_LOCATIONS = ('s3://snowflake-aws-staging-bucket/basketball-database/')
STORAGE_AWS_ROLE_ARN = 'arn:aws:iam::349753763327:role/AWS-Snowflake-Role';

DESC STORAGE INTEGRATION AWS_INTG_SNOWFLAKE;

CREATE STAGE AWS_STG_BB
URL = 's3://snowflake-aws-staging-bucket/basketball-database/cbb17.csv'
STORAGE_INTEGRATION = AWS_INTG_SNOWFLAKE;

ls @AWS_STG_BB;
select $1,$2,$3 from @AWS_STG_BB;

CREATE FILE FORMAT CSV_BB 
TYPE = CSV
FIELD_DELIMITER = ','
RECORD_DELIMITER='\n'
SKIP_HEADER = 1

CREATE TABLE BB_TABLE(TEAM VARCHAR(255),CONF VARCHAR(255),g INT);

COPY INTO BB_TABLE FROM (select $1,$2,$3 from @AWS_STG_BB)
FILE_FORMAT=CSV_BB;

SELECT * FROM BB_TABLE;